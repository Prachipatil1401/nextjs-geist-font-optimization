(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[36],{17710:(e,s,a)=>{Promise.resolve().then(a.bind(a,67786))},35695:(e,s,a)=>{"use strict";var r=a(18999);a.o(r,"useRouter")&&a.d(s,{useRouter:function(){return r.useRouter}})},55365:(e,s,a)=>{"use strict";a.d(s,{Fc:()=>n,TN:()=>c});var r=a(95155);a(12115);var t=a(74466),l=a(59434);let i=(0,t.F)("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function n(e){let{className:s,variant:a,...t}=e;return(0,r.jsx)("div",{"data-slot":"alert",role:"alert",className:(0,l.cn)(i({variant:a}),s),...t})}function c(e){let{className:s,...a}=e;return(0,r.jsx)("div",{"data-slot":"alert-description",className:(0,l.cn)("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",s),...a})}},67786:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>v});var r=a(95155),t=a(12115),l=a(35695),i=a(39714);let n={width:1280,height:720,facingMode:"environment",audio:!1},c=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[s,a]=(0,t.useState)({isActive:!1,isCapturing:!1,hasPermission:!1,error:null,stream:null}),r=(0,t.useRef)(null),l=(0,t.useRef)(null),c={...n,...e},d=(0,t.useCallback)(async()=>{try{a(e=>({...e,error:null}));let e={video:{width:{ideal:c.width},height:{ideal:c.height},facingMode:c.facingMode},audio:c.audio},s=await navigator.mediaDevices.getUserMedia(e);return l.current=s,a(e=>({...e,hasPermission:!0,stream:s,error:null})),{success:!0}}catch(s){let e=s instanceof Error?s.message:"Camera access denied";return a(s=>({...s,hasPermission:!1,error:e})),{success:!1,error:e}}},[c]),o=(0,t.useCallback)(async()=>{if(!s.hasPermission){let e=await d();if(!e.success)return e}try{if(r.current&&l.current)return r.current.srcObject=l.current,await r.current.play(),a(e=>({...e,isActive:!0,error:null})),{success:!0};return{success:!1,error:"Video element not available"}}catch(s){let e=s instanceof Error?s.message:"Failed to start camera";return a(s=>({...s,error:e})),{success:!1,error:e}}},[s.hasPermission,d]),u=(0,t.useCallback)(()=>{l.current&&(l.current.getTracks().forEach(e=>e.stop()),l.current=null),r.current&&(r.current.srcObject=null),a(e=>({...e,isActive:!1,stream:null}))},[]),x=(0,t.useCallback)(()=>{if(!r.current||!s.isActive)return null;try{a(e=>({...e,isCapturing:!0}));let e=i.C.captureFromVideo(r.current,c.width,c.height);return a(e=>({...e,isCapturing:!1})),e}catch(e){return a(s=>({...s,isCapturing:!1,error:e instanceof Error?e.message:"Failed to capture image"})),null}},[s.isActive,c.width,c.height]),h=(0,t.useCallback)(async()=>{let e="user"===c.facingMode?"environment":"user";u();let s={...c,facingMode:e};try{let e={video:{width:{ideal:s.width},height:{ideal:s.height},facingMode:s.facingMode},audio:s.audio},t=await navigator.mediaDevices.getUserMedia(e);return l.current=t,r.current&&(r.current.srcObject=t,await r.current.play()),a(e=>({...e,isActive:!0,stream:t,error:null})),{success:!0}}catch(s){let e=s instanceof Error?s.message:"Failed to switch camera";return a(s=>({...s,error:e})),{success:!1,error:e}}},[c,u]),m=(0,t.useCallback)(async()=>(u(),a(e=>({...e,error:null,hasPermission:!1})),await o()),[u,o]);(0,t.useEffect)(()=>()=>{u()},[u]);let g=(0,t.useCallback)(()=>!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia),[]);return{...s,videoRef:r,requestPermission:d,startCamera:o,stopCamera:u,captureImage:x,switchCamera:h,retryCamera:m,isCameraSupported:g,config:c}};var d=a(49589),o=a(39471),u=a(30285),x=a(66695),h=a(55365),m=a(26126),g=a(6874),j=a.n(g);function v(){let e=(0,l.useRouter)(),{isAuthenticated:s}=(0,o.A)(),{videoRef:a,isActive:i,isCapturing:n,hasPermission:g,error:v,startCamera:p,stopCamera:f,captureImage:b,switchCamera:y,retryCamera:N,isCameraSupported:w}=c(),{isLoaded:C,isLoading:k,isAnalyzing:A,analyzeImageFromCamera:R,error:E}=(0,d.i)(),[P,z]=(0,t.useState)(null),[D,F]=(0,t.useState)(!1),[M,$]=(0,t.useState)(null);(0,t.useEffect)(()=>{w()||console.error("Camera not supported")},[w]);let S=async()=>{let e=await p();e.success||console.error("Failed to start camera:",e.error)},Z=async()=>{try{let e=b();if(!e)return void alert("Failed to capture image. Please try again.");$(e.dataUrl),F(!0);let s=await R(e);s?z(s):alert("Analysis failed. Please try again.")}catch(e){console.error("Error during capture and analysis:",e),alert("An error occurred. Please try again.")}};return w()?(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,r.jsx)("header",{className:"bg-white shadow-sm border-b",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"flex justify-between items-center h-16",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)(j(),{href:"/",children:(0,r.jsx)(u.$,{variant:"ghost",size:"sm",children:"← Back"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"Live Camera Detection"}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Real-time plant disease analysis"})]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[C&&(0,r.jsx)(m.E,{variant:"default",className:"bg-green-100 text-green-800",children:"AI Model Ready"}),k&&(0,r.jsx)(m.E,{variant:"secondary",children:"Loading AI Model..."})]})]})})}),(0,r.jsx)("main",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:D?(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Analysis Results"}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)(u.$,{onClick:()=>{F(!1),z(null),$(null)},variant:"outline",children:"Take Another Photo"}),s&&P&&(0,r.jsx)(u.$,{onClick:()=>{P&&e.push("/results")},className:"bg-green-600 hover:bg-green-700",children:"View All Results"})]})]}),(0,r.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,r.jsxs)(x.Zp,{children:[(0,r.jsx)(x.aR,{children:(0,r.jsx)(x.ZB,{children:"Captured Image"})}),(0,r.jsx)(x.Wu,{children:M&&(0,r.jsx)("img",{src:M,alt:"Captured plant",className:"w-full h-64 object-cover rounded-lg"})})]}),(0,r.jsxs)(x.Zp,{children:[(0,r.jsxs)(x.aR,{children:[(0,r.jsx)(x.ZB,{children:"Detection Results"}),(0,r.jsx)(x.BT,{children:P?"Analysis completed with ".concat(P.confidence.toFixed(1),"% confidence"):"Analyzing image..."})]}),(0,r.jsx)(x.Wu,{children:A?(0,r.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Analyzing plant health..."})]})}):P?(0,r.jsx)("div",{className:"space-y-4",children:P.isHealthy?(0,r.jsxs)("div",{className:"text-center py-4",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,r.jsx)("div",{className:"w-8 h-8 bg-green-600 rounded-full"})}),(0,r.jsx)("h3",{className:"text-lg font-semibold text-green-600 mb-2",children:"Healthy Plant Detected!"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Your plant appears to be healthy with no signs of disease."})]}):(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("h3",{className:"font-semibold text-red-600 mb-3",children:"Disease Detected"}),P.detectedDiseases.map((e,s)=>{var a;return(0,r.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,r.jsx)("h4",{className:"font-medium text-gray-900",children:e.name}),(0,r.jsxs)(m.E,{variant:"destructive",children:[null==(a=e.confidence)?void 0:a.toFixed(1),"%"]})]}),(0,r.jsx)("p",{className:"text-sm text-gray-600 mb-3",children:e.description}),e.treatments.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h5",{className:"font-medium text-sm mb-2",children:"Recommended Treatment:"}),(0,r.jsxs)("div",{className:"bg-blue-50 p-3 rounded-lg",children:[(0,r.jsx)("p",{className:"font-medium text-sm text-blue-900",children:e.treatments[0].name}),(0,r.jsx)("p",{className:"text-xs text-blue-700 mt-1",children:e.treatments[0].description}),(0,r.jsxs)("div",{className:"mt-2 text-xs text-blue-600",children:[(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Application:"})," ",e.treatments[0].applicationMethod]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Dosage:"})," ",e.treatments[0].dosage]})]})]})]})]},e.id)})]})}):(0,r.jsx)("div",{className:"text-center py-8 text-gray-500",children:"Analysis failed. Please try again."})})]})]}),P&&!P.isHealthy&&(0,r.jsxs)(x.Zp,{children:[(0,r.jsx)(x.aR,{children:(0,r.jsx)(x.ZB,{children:"Next Steps"})}),(0,r.jsx)(x.Wu,{children:(0,r.jsxs)("div",{className:"grid sm:grid-cols-2 gap-4",children:[(0,r.jsx)(j(),{href:"/results",children:(0,r.jsx)(u.$,{variant:"outline",className:"w-full",children:"View Treatment Details"})}),(0,r.jsx)(u.$,{variant:"outline",className:"w-full",children:"Export Report"})]})})]})]}):(0,r.jsxs)("div",{className:"space-y-6",children:[(v||E)&&(0,r.jsx)(h.Fc,{variant:"destructive",children:(0,r.jsxs)(h.TN,{children:[v||E,v&&(0,r.jsx)(u.$,{variant:"outline",size:"sm",className:"ml-2",onClick:N,children:"Retry"})]})}),!C&&!k&&(0,r.jsx)(h.Fc,{children:(0,r.jsx)(h.TN,{children:"AI model is loading. Please wait for better detection accuracy."})}),(0,r.jsx)(x.Zp,{className:"overflow-hidden",children:(0,r.jsx)(x.Wu,{className:"p-0",children:(0,r.jsxs)("div",{className:"relative bg-black aspect-video",children:[i?(0,r.jsx)("video",{ref:a,className:"w-full h-full object-cover",autoPlay:!0,playsInline:!0,muted:!0}):(0,r.jsx)("div",{className:"flex items-center justify-center h-full text-white",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-gray-600 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,r.jsx)("div",{className:"w-8 h-8 bg-gray-400 rounded-full"})}),(0,r.jsx)("p",{className:"text-lg mb-2",children:"Camera Not Active"}),(0,r.jsx)("p",{className:"text-sm text-gray-300",children:'Click "Start Camera" to begin detection'})]})}),i&&(0,r.jsxs)("div",{className:"absolute inset-0 pointer-events-none",children:[(0,r.jsx)("div",{className:"absolute inset-4 border-2 border-white border-dashed rounded-lg opacity-50"}),(0,r.jsx)("div",{className:"absolute top-4 left-4 right-4",children:(0,r.jsxs)("div",{className:"bg-black bg-opacity-50 text-white p-3 rounded-lg text-sm",children:[(0,r.jsx)("p",{className:"font-medium mb-1",children:"Detection Tips:"}),(0,r.jsxs)("ul",{className:"text-xs space-y-1",children:[(0,r.jsx)("li",{children:"• Hold camera steady and focus on leaves"}),(0,r.jsx)("li",{children:"• Ensure good lighting conditions"}),(0,r.jsx)("li",{children:"• Keep plant within the frame"})]})]})}),(0,r.jsx)("div",{className:"absolute bottom-4 left-4 right-4 flex justify-between items-center",children:(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)(m.E,{variant:C?"default":"secondary",children:C?"AI Ready":"AI Loading"}),(0,r.jsx)(m.E,{variant:"outline",className:"bg-black bg-opacity-50 text-white border-white",children:"Live"})]})})]})]})})}),(0,r.jsx)("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:i?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(u.$,{onClick:Z,size:"lg",className:"bg-blue-600 hover:bg-blue-700",disabled:n||A||!C,children:n||A?(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),(0,r.jsx)("span",{children:n?"Capturing...":"Analyzing..."})]}):"Capture & Analyze"}),(0,r.jsx)(u.$,{onClick:y,variant:"outline",size:"lg",children:"Switch Camera"}),(0,r.jsx)(u.$,{onClick:f,variant:"outline",size:"lg",children:"Stop Camera"})]}):(0,r.jsx)(u.$,{onClick:S,size:"lg",className:"bg-green-600 hover:bg-green-700",disabled:!g&&null!==v,children:"Start Camera"})}),(0,r.jsxs)(x.Zp,{children:[(0,r.jsx)(x.aR,{children:(0,r.jsx)(x.ZB,{className:"text-lg",children:"How to Use"})}),(0,r.jsx)(x.Wu,{children:(0,r.jsxs)("ol",{className:"list-decimal list-inside space-y-2 text-sm text-gray-600",children:[(0,r.jsx)("li",{children:'Click "Start Camera" to activate your device camera'}),(0,r.jsx)("li",{children:"Point the camera at plant leaves you want to analyze"}),(0,r.jsx)("li",{children:"Ensure good lighting and focus on the plant"}),(0,r.jsx)("li",{children:'Click "Capture & Analyze" to take a photo and detect diseases'}),(0,r.jsx)("li",{children:"Review the results and treatment recommendations"})]})})]})]})})]}):(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:(0,r.jsxs)(x.Zp,{className:"w-full max-w-md",children:[(0,r.jsxs)(x.aR,{children:[(0,r.jsx)(x.ZB,{className:"text-red-600",children:"Camera Not Supported"}),(0,r.jsx)(x.BT,{children:"Your device or browser doesn't support camera access"})]}),(0,r.jsxs)(x.Wu,{children:[(0,r.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"Please try using a modern browser or upload images from your gallery instead."}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(j(),{href:"/gallery",children:(0,r.jsx)(u.$,{className:"w-full",children:"Upload from Gallery"})}),(0,r.jsx)(j(),{href:"/",children:(0,r.jsx)(u.$,{variant:"outline",className:"w-full",children:"Back to Home"})})]})]})]})})}}},e=>{var s=s=>e(e.s=s);e.O(0,[56,690,251,87,660,674,272,361,912,178,441,684,358],()=>s(17710)),_N_E=e.O()}]);